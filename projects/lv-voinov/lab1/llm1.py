import ollama
import time
import json


prompts = [
    """
Ты — автор популярного блога о продуктивности. Твоя задача — написать короткий, но вдохновляющий пост в LinkedIn (не более 3 абзацев) на основе идеи пользователя.

Используй следующий каркас:
1.  Заголовок-крючок: Придумай яркий и интригующий заголовок.
2.  Проблема: Кратко опиши распространенную проблему (используй идею пользователя ниже).
3.  Решение: Предложи метод из 2 шагов для её решения. Назови этот метод запоминающимся именем (например, "Принцип двух минут" или "Система чистого листа").
4.  Призыв к действию: Заверши пост открытым вопросом к аудитории, чтобы спровоцировать обсуждение в комментариях.

Идея пользователя: "Как перестать откладывать сложные звонки на потом?"

Стиль: Мотивирующий, энергичный, деловой, но неформальный. Используй эмодзи (2-3 штуки на весь пост) для расстановки акцентов.

Начни сразу с заголовка.
    """,
    """
Классифицируй следующие пользовательские запросы в одну из трёх фиксированных категорий: ["Billing", "Tech support", "Sales"]. Ответ дай только в виде названия категории, без пояснений.

Список запросов:
1. "У меня не скачивается счет за прошлый месяц, вы можете прислать его на почту?"
2. "Расскажите, есть ли скидки при покупке более 10 лицензий?"
3. "Приложение постоянно вылетает при попытке открыть раздел настроек, что делать?"
4. "Я хотел бы отменить подписку, так как она мне больше не нужна."
5. "Ваш тариф 'Профессиональный' включает в себя возможность создания белых ярлыков?"
6. "Мой платеж прошел два раза, я вижу две одинаковые транзакции на своей карте. Помогите разобраться и верните средства."
7. "Перед покупкой хочу уточнить, совместим ли ваш программный продукт с операционной системой Linux?"
8. "После последнего обновления я не могу найти функцию экспорта данных в PDF. Она была удалена или перемещена?"
9. "Я представитель учебного заведения. Мы заинтересованы в оптовом заказе для компьютерного класса. Можете ли вы подготовить для нас коммерческое предложение?"
10. "Автоплатеж по моей подписке не сработал, хотя на карте есть средства. Как мне возобновить доступ к сервису?"
    """,
    """
Проанализируй предоставленный отзыв клиента и выполни три задачи:

1. Извлеки следующую информацию в формате JSON:
   - `product_name` (название товара)
   - `customer_sentiment` (настроение: "positive", "negative", "neutral")
   - `mentioned_features` (список упомянутых в отзыве характеристик товара)
   - `main_issue` (основная проблема или похвала, одним предложением)

2. Суммаризируй отзыв в одно-два предложения.

3. Переформулируй основную жалобу или предложение в виде формального запроса в службу поддержки.

Текст отзыва:
"Купил новый смартфон 'Solaris X5'. Дизайн просто фантастический, очень стильный и удобно лежит в руке. Экран просто огонь, цвета сочные. Но батарея, к сожалению, совсем не держит заряда, к вечеру уже приходится искать розетку, хотя продавали как устройство с долгим временем работы. И камера ночью снимает не очень, много шумов. В общем, для повседневных задач пойдет, но как основной смартфон для путешествий - не рекомендую."
    """
]

models = [
    "gemma3n:e4b",
    "gpt-oss:20b",
    "qwen3:30b-instruct"
]

results = []

for model in models:
    for prompt in prompts:
        try:
            start_time = time.time()
            response = ollama.generate(model=model, prompt=prompt, options={
                'temperature': 0.1,
                'top_p': 0.9,
                'repeat_penalty': 1.2
            })
            end_time = time.time()

            stats = {
                'model': model,
                'prompt': prompt,
                'eval_count': response.get('eval_count', 0),
                'prompt_eval_count': response.get('prompt_eval_count', 0),
                'total_duration': response.get('total_duration', 0),
                'load_duration': response.get('load_duration', 0),
                'eval_duration': response.get('eval_duration', 0),
                'response_time': end_time - start_time,
                'response_text': response.get('response', ''),
                'speed': response.get('eval_count', 0) / (response.get('eval_duration', 0) / 1000000000)
            }
            results.append(stats)

            print(f"Модель: {stats['model']}")
            print(f"Промпт: {stats['prompt'][:20]}")
            print(f"Токенов промпта: {stats['prompt_eval_count']}")
            print(f"Сгенерировано токенов: {stats['eval_count']}")
            print(f"Общее время: {stats['total_duration'] / 1000000000} с")
            print(f"Время генерации: {stats['eval_duration'] / 1000000000} с")
            print(f"Время ответа: {stats['response_time']} с")
            print(f"Скорость генерации: {stats['speed']} ток/с")
            print("---")

        except Exception as e:
            print(f"Ошибка с моделью {model}: {str(e)}")

output_file = "ollama_benchmark_results_modified.json"
with open(output_file, "w", encoding="utf-8") as f:
    json.dump(results, f, ensure_ascii=False, indent=4)

print(f"Результаты сохранены в: {output_file}")
